<Page
    x:Class="RawEditor.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:uihelper="using:RawEditor.View.UIHelper"
    mc:Ignorable="d"  >

    <Page.BottomAppBar>
        <CommandBar x:Name="commandBar" VerticalContentAlignment="Top" 
                    VerticalAlignment="Stretch"
                    HorizontalContentAlignment="Left">
            <CommandBar.Content>
                <ProgressRing x:Name="ProgressDisplay" VerticalAlignment="Center" 
                                  Height="30" Width="30" IsActive="True" Visibility="Collapsed"
                                  Margin="2,9,0,0"/>
            </CommandBar.Content>

            <AppBarButton IsEnabled="False" 
                x:Name="RotateLeftButton" 
                          Icon="Undo"
                          x:Uid="RotateLeft"                           
                          Tapped="RotateLeftButton_Tapped"/>
            <AppBarButton IsEnabled="False" 
                          x:Name="RotateRightButton" 
                          Icon="Redo"
                          x:Uid="RotateRight" 
                          Tapped="RotateRightButton_Tapped"/>
            <AppBarButton IsEnabled="False" 
                          x:Name="CropButton" 
                          Icon="Crop"
                          x:Uid="Crop" 
                          Tapped="CropButton_TappedAsync"/>
            <AppBarSeparator/>
            <AppBarButton x:Name="ImageChooseButton"
                          Icon="BrowsePhotos"
                          x:Uid="OpenImage" 
                          Click="ImageChooseClickAsync"/>
            <AppBarButton x:Name="SaveButton"
                          Icon="SaveLocal"
                          x:Uid="Save" 
                          Click="SaveButtonClickAsync"
                          VerticalAlignment="Top"
                          IsEnabled="False"/>
            <AppBarButton IsEnabled="False" 
                          x:Name="ShareButton" 
                          Icon="Link"
                          x:Uid="Share" 
                          Tapped="ShareButton_Tapped"/>
            <AppBarSeparator/>
            <AppBarButton x:Name="settingsButton" 
                          Icon="Setting" x:Uid="Setting" 
                          Click="SettingClick"/>
            <CommandBar.SecondaryCommands>
               <AppBarButton x:Name="ReportButton"  
                          Tapped="ReportButton_Tapped" Icon="MailForward" Label="Report issue"/>
                <AppBarButton x:Name="GitterButton"  
                          Tapped="GitterButton_Tapped" Icon="Comment" Label="Send suggestion"/>
            </CommandBar.SecondaryCommands>
        </CommandBar>
    </Page.BottomAppBar>
    <Grid>
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="VisualStateGroupeMainUI">
                <!-- Landscape -->
                <VisualState x:Name="wideState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="1080" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="commandBar.DefaultLabelPosition" Value="Right"></Setter>
                        <Setter Target="MainGrid.RowDefinitions[1].Height" Value="auto"/>
                        <Setter Target="MainGrid.ColumnDefinitions[0].Width" Value="3*"/>
                        <Setter Target="MainGrid.ColumnDefinitions[1].Width" Value="*"/>
                        <Setter Target="ImageDisplay.Margin" Value="0 0 1 0"/>
                        <Setter Target="PivotGrid.Margin" Value="1 0 0 0"/>
                        <Setter Target="PivotGrid.(Grid.Column)" Value="1"/>
                        <Setter Target="PivotGrid.(Grid.Row)" Value="0"/>
                    </VisualState.Setters>
                </VisualState>
                <VisualState x:Name="normalState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="640" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="commandBar.DefaultLabelPosition" Value="Bottom"></Setter>
                        <Setter Target="MainGrid.RowDefinitions[1].Height" Value="auto"/>
                        <Setter Target="MainGrid.ColumnDefinitions[0].Width" Value="2*"/>
                        <Setter Target="MainGrid.ColumnDefinitions[1].Width" Value="*"/>
                        <Setter Target="ImageDisplay.Margin" Value="0 0 1 0"/>
                        <Setter Target="PivotGrid.Margin" Value="1 0 0 0"/>
                        <Setter Target="PivotGrid.(Grid.Column)" Value="1"/>
                        <Setter Target="PivotGrid.(Grid.Row)" Value="0"/>
                    </VisualState.Setters>
                </VisualState>

                <!-- Portrait -->
                <VisualState x:Name="narrowState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="0" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="commandBar.DefaultLabelPosition" Value="Bottom"></Setter>
                        <Setter Target="ImageDisplay.Margin" Value="0 0 0 1"/>
                        <Setter Target="PivotGrid.Margin" Value="0 1 0 0"/>
                        <Setter Target="MainGrid.RowDefinitions[0].Height" Value="4*"/>
                        <Setter Target="MainGrid.RowDefinitions[1].Height" Value="5*"/>
                        <Setter Target="MainGrid.ColumnDefinitions[1].Width" Value="0"/>
                        <Setter Target="PivotGrid.(Grid.Column)" Value="0"/>
                        <Setter Target="PivotGrid.(Grid.Row)" Value="1"/>
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
        <Grid x:Name="MainGrid">
            <Grid.ColumnDefinitions>
                <ColumnDefinition/>
                <ColumnDefinition MaxWidth="460"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition/>
                <RowDefinition/>
            </Grid.RowDefinitions>
            <ScrollViewer x:Name="ImageDisplay" ZoomMode="Enabled"                                                 
                          HorizontalScrollBarVisibility="Auto"
                          VerticalScrollBarVisibility="Auto" 
                          RelativePanel.AlignTopWithPanel="True" 
                          RelativePanel.AlignLeftWithPanel="True"  
                          HorizontalContentAlignment="Stretch" 
                          VerticalContentAlignment="Stretch" ViewChanged="ImageDisplay_ViewChanged" >
                <ScrollViewer.Background>
                    <SolidColorBrush Color="#19FFFFFF"/>
                </ScrollViewer.Background>
                <Image x:Name="ImageBox"/>
            </ScrollViewer>
            <Slider  x:Name="ZoomSlider" IsEnabled="False" Minimum="0.1" Maximum="2" SmallChange="0.1" StepFrequency="0.1"
                     Canvas.ZIndex="3" Margin="10,0,0,10" ValueChanged="Slider_ValueChanged" 
                     Orientation="Vertical" HorizontalAlignment="Left" Height="200" VerticalAlignment="Bottom"/>

            <Grid x:Name="CropGrid" Visibility="Collapsed" Canvas.ZIndex="5" Background="#FFAAAAAA" >
                <uihelper:CropUIHelper x:Name="CropUI"></uihelper:CropUIHelper>
                <Button x:Name="CropAccept" VerticalAlignment="Bottom" HorizontalAlignment="Center" Background="{ThemeResource ButtonForeground}" Tapped="CropAccept_Tapped" Margin="0,0,10,10">
                    <SymbolIcon Symbol="Accept" Width="20" Height="20" Foreground="{ThemeResource AppBarBorderThemeBrush}"></SymbolIcon>
                </Button>
                <Button x:Name="CropReject" VerticalAlignment="Bottom" HorizontalAlignment="Center" Margin="0,0,100,10" Background="{ThemeResource ButtonForeground}" Tapped="CropReject_Tapped">
                    <SymbolIcon Symbol="Clear" Foreground="{ThemeResource AppBarBorderThemeBrush}" Width="20" Height="20"/>
                </Button>
            </Grid>
            <Pivot x:Name="PivotGrid" RelativePanel.AlignRightWithPanel="True" 
                  RelativePanel.AlignBottomWithPanel="True">
                <PivotItem x:Uid="ProcessingHeader">
                    <ScrollViewer VerticalContentAlignment="Stretch">
                        <StackPanel Margin="0,0,36,0" >
                            <!--The histogram-->
                            <TextBlock Foreground="Black" 
                                           IsDoubleTapEnabled="False" IsHoldingEnabled="False" IsRightTapEnabled="False" IsTapEnabled="False" ManipulationMode="None" HorizontalAlignment="Left"
                                           FontSize="14" x:Uid="Histogram"/>
                            <Grid>
                                <Polygon x:Name="RedHisto" Opacity="0.4" Stretch="Fill" Fill="#FFCF0000" Width="300" Height="120"/>
                                <Polygon x:Name="GreenHisto" Opacity="0.4" Stretch="Fill" Fill="#FF00B200" Width="300" Height="120"/>
                                <Polygon x:Name="BlueHisto" Opacity="0.4" Stretch="Fill" Fill="#FF000083" Width="300" Height="120"/>
                                <Polygon x:Name="LumaHisto" Opacity="0.9" Stretch="Fill" Fill="#FF555555" Width="300" Height="120"/>
                            </Grid>

                            <Button x:Name="ResetButton" Margin="0,10,0,5" HorizontalAlignment="Center" Tapped="ResetButton_Tapped" Padding="8,2" >Reset</Button>
                            <TextBlock FontSize="16" x:Uid="ExplosureSettings" />
                            <TextBlock FontSize="12" x:Uid="Exposure"/>
                            <Slider x:Name="exposureSlider"  PointerCaptureLost="Slider_PointerCaptureLost"  Maximum="5" Minimum="-5" LargeChange="1" SmallChange="0.3" IsEnabled="False" StepFrequency="0.3"/>
                            <!-- <TextBlock FontSize="12">Brightness</TextBlock>
                                <Slider x:Name="brightnessSlider"  PointerCaptureLost="Slider_PointerCaptureLost"  Minimum="-100" Maximum="100"  LargeChange="10" SmallChange="5" IsEnabled="False" StepFrequency="5"/>
                                -->
                            <TextBlock FontSize="12"> Highlight</TextBlock>
                            <Slider x:Name="HighLightSlider"  PointerCaptureLost="Slider_PointerCaptureLost"  Maximum="50" Minimum="-50" LargeChange="5" SmallChange="1" IsEnabled="False"  StepFrequency="1"/>
                            <TextBlock FontSize="12">Shadow
                            </TextBlock>
                            <Slider x:Name="ShadowSlider"  PointerCaptureLost="Slider_PointerCaptureLost"  Maximum="50" Minimum="-50" LargeChange="5" SmallChange="1" IsEnabled="False"  StepFrequency="1"/>
                            <Rectangle Width="120" Height="1" Fill="#FF343434" Margin="0,6,0,0"/>

                            <TextBlock Foreground="Black" FontSize="16" x:Uid="ColorBalance"/>
                            <!--<TextBlock FontSize="12" x:Uid="Temperature"/>-->
                            <TextBlock FontSize="12">Red</TextBlock>
                            <Slider x:Name="colorTempSlider"   PointerCaptureLost="WBSlider_DragStop"  Maximum="765" Minimum="1" LargeChange="50" SmallChange="5" Value="255" IsEnabled="False"/>
                            <TextBlock FontSize="12" >Green</TextBlock>
                            <Slider x:Name="colorTintSlider"    PointerCaptureLost="WBSlider_DragStop"  Maximum="765" Minimum="1" LargeChange="50" SmallChange="5" Value="255" IsEnabled="False"/>
                            <TextBlock FontSize="12">Blue</TextBlock>
                            <Slider x:Name="colorTintBlueSlider"    PointerCaptureLost="WBSlider_DragStop"  Maximum="765" Minimum="1" LargeChange="50" SmallChange="5" Value="255" IsEnabled="False"/>

                            <Button IsEnabled="False" Click="CameraWBCheck_Click" FontSize="12" Grid.Column="1" 
                                        x:Name="cameraWBCheck" HorizontalAlignment="Center" x:Uid="WBButton" Margin="0,0,0,10"/>
                            <TextBlock FontSize="12" x:Uid="Saturation"/>
                            <Slider x:Name="saturationSlider"   PointerCaptureLost="Slider_PointerCaptureLost"  Minimum="-100" Maximum="100"  LargeChange="10" SmallChange="5" IsEnabled="False"/>
                            <!-- <TextBlock FontSize="12">Vibrance</TextBlock>
                                <Slider x:Name="vibranceSlider"    PointerCaptureLost="Slider_PointerCaptureLost"  Maximum="512" Minimum="1" LargeChange="50" SmallChange="5" Value="256" IsEnabled="False"/>
-->
                            <Rectangle Width="120" Height="1" Fill="#FF343434" Margin="0,6,0,0"/>
                            <TextBlock Foreground="Black" FontSize="16" x:Uid="ContrastBalance"/>

                            <TextBlock FontSize="12" x:Uid="Contrast"/>
                            <Slider x:Name="contrastSlider"  PointerCaptureLost="Slider_PointerCaptureLost" Maximum="13" LargeChange="1" Value="10" Minimum="7" StepFrequency="0.01" IsEnabled="False" />
                            <Rectangle Width="120" Height="1" Fill="#FF343434" Margin="0,6,0,0"/>
                            <!--
                            <TextBlock FontSize="12" >Crop</TextBlock>
                            <Grid Width="250" Height="250">
                                <Slider Height="200" x:Name="TopSlider"  PointerCaptureLost="Slider_PointerCaptureLost" Maximum="100" LargeChange="10" Value="0" Minimum="0"  IsEnabled="False" Orientation="Vertical" VerticalAlignment="Top" HorizontalAlignment="Left" IsDirectionReversed="True" Margin="0,50,0,0" />
                                <Slider Height="200" x:Name="BottomSlider"  PointerCaptureLost="Slider_PointerCaptureLost" Maximum="100" LargeChange="10" Value="100" Minimum="1"  IsEnabled="False" Orientation="Vertical" VerticalAlignment="Bottom" HorizontalAlignment="Right" IsDirectionReversed="True" Margin="0,0,0,50" />
                                <Slider Width="200" x:Name="LeftSlider"  PointerCaptureLost="Slider_PointerCaptureLost" Maximum="100" LargeChange="10" Value="0" Minimum="0" IsEnabled="False" HorizontalAlignment="Left" VerticalAlignment="Top" />
                                <Slider Width="200" x:Name="RightSlider"  PointerCaptureLost="Slider_PointerCaptureLost" Maximum="100" LargeChange="10" Value="100" Minimum="1" IsEnabled="False" VerticalAlignment="Bottom" HorizontalAlignment="Right" />
                            </Grid>
                            <Rectangle Width="120" Height="1" Fill="#FF343434" Margin="0,6,0,0"/>
                        -->
                        </StackPanel>
                    </ScrollViewer>
                </PivotItem>
                <!-- <PivotItem x:Uid="Tools">
                        <StackPanel Background="#FFF0F0F0">
                            <Button>Save Thumbnail</Button>
                        </StackPanel>
                    </PivotItem>
                    <PivotItem x:Uid="Presets">
                        <GridView Background="White" ></GridView>
                    </PivotItem>-->
                <PivotItem x:Uid="History">
                    <ScrollViewer VerticalContentAlignment="Stretch">
                        <ListView ItemsSource="{x:Bind history}" x:Name="HistoryDisplay" VerticalAlignment="Top" HorizontalAlignment="Left" >
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition />
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="{Binding Target}" TextWrapping="Wrap" Margin="0,0,5,0" HorizontalAlignment="Left" />
                                        <TextBlock Grid.Column="1" Text="{Binding ValueAsString}" TextWrapping="Wrap" HorizontalAlignment="Right" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </ScrollViewer>
                </PivotItem>
                <PivotItem x:Uid="Exifs">
                    <ScrollViewer VerticalContentAlignment="Stretch">
                        <StackPanel>
                            <TextBlock x:Uid="ExifsData"/>
                            <ListView  x:Name="ExifDisplay" VerticalAlignment="Top" HorizontalAlignment="Left" >
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition />
                                                <ColumnDefinition />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="{Binding Key}" TextWrapping="Wrap" Margin="0,0,5,0" HorizontalAlignment="Left" />
                                            <TextBlock Grid.Column="1" Text="{Binding Value}" TextWrapping="Wrap" HorizontalAlignment="Right" />
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </StackPanel>
                    </ScrollViewer>
                </PivotItem>
            </Pivot>

        </Grid>
    </Grid>
</Page>
